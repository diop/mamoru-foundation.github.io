<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mamoru Developer Docs</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="overview/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="overview/system-architecture.html"><strong aria-hidden="true">1.1.</strong> System Architecture</a></li><li class="chapter-item expanded "><a href="overview/supported-networks.html"><strong aria-hidden="true">1.2.</strong> Supported networks</a></li><li class="chapter-item expanded "><a href="overview/monitoring-detection.html"><strong aria-hidden="true">1.3.</strong> Monitoring and detection</a></li><li class="chapter-item expanded "><a href="overview/incident-response.html"><strong aria-hidden="true">1.4.</strong> Incident response</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Guides</li><li class="chapter-item expanded "><a href="guides/sql-daemon-development.html"><strong aria-hidden="true">2.</strong> SQL Daemon Development</a></li><li class="chapter-item expanded "><a href="guides/wasm-daemon-development.html"><strong aria-hidden="true">3.</strong> WASM Daemon Development</a></li><li class="chapter-item expanded "><a href="guides/using-the-mamoru-cli.html"><strong aria-hidden="true">4.</strong> Mamoru CLI</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Subscribing for incidents</div></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="reference/cli.html"><strong aria-hidden="true">6.</strong> Mamoru CLI Reference</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><div>Mamoru Daemon API Reference</div></li><li class="chapter-item expanded affix "><div>Developer FAQ</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mamoru Developer Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<h2 id="tbd"><a class="header" href="#tbd">TBD</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-architecture"><a class="header" href="#system-architecture">System Architecture</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-networks"><a class="header" href="#supported-networks">Supported networks</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monitoring-and-detection"><a class="header" href="#monitoring-and-detection">Monitoring and detection</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="incident-response"><a class="header" href="#incident-response">Incident response</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-daemon-development"><a class="header" href="#sql-daemon-development">SQL Daemon Development</a></h1>
<p>SQL Daemons allow you to define incident matching logic using SQL.
You can write an SQL query against a blockchain context, and if it returns something, the system emits an incident.</p>
<ol>
<li><a href="guides/sql-daemon-development.html#prerequisite">Prerequisite</a>
<ol>
<li><a href="guides/sql-daemon-development.html#setup-environment">Setup environment</a></li>
<li><a href="guides/sql-daemon-development.html#define-contract-for-monitoring">Define contract for monitoring</a></li>
</ol>
</li>
<li><a href="guides/sql-daemon-development.html#creating-a-daemon">Creating a Daemon</a></li>
<li><a href="guides/sql-daemon-development.html#testing">Testing</a></li>
<li><a href="guides/sql-daemon-development.html#deploying">Deploying</a></li>
</ol>
<h2 id="prerequisite"><a class="header" href="#prerequisite">Prerequisite</a></h2>
<h3 id="setup-environment"><a class="header" href="#setup-environment">Setup environment</a></h3>
<h4 id="install-validatoin-chaind"><a class="header" href="#install-validatoin-chaind">Install <code>validatoin-chaind</code></a></h4>
<p>You need the validation-chaind CLI to interact with the Mamoru Validation Chain.
It is available in the <code>mamorufoundation/validation-chain:latest</code> docker image.</p>
<p>Usage:</p>
<pre><code class="language-shell">docker run -it --rm mamorufoundation/validation-chain:latest {subcommand}
</code></pre>
<p>Consider creating a command alias for convenience:</p>
<pre><code class="language-shell">alias validation-chaind=&quot;docker run -it --rm -v $HOME/.validation-chain:/root/.validation-chain mamorufoundation/validation-chain:latest&quot;
</code></pre>
<h4 id="create-and-fund-an-account"><a class="header" href="#create-and-fund-an-account">Create and fund an account</a></h4>
<p>Execute the following command:</p>
<pre><code class="language-shell">validation-chaind keys add sql-daemon-guide
</code></pre>
<p>This commands adds an account named <code>sql-daemon-guide</code> to your keychain.
Take the newly created account address (look like <code>cosmos1qaar0r0tyyy6ufslam0hv9zvhvy0z0cv5x8xev</code>) and fund it with some tokens.</p>
<p>// TODO: make public faucet for a testnet</p>
<h3 id="define-contract-for-monitoring"><a class="header" href="#define-contract-for-monitoring">Define contract for monitoring</a></h3>
<p>In this guide, we will work with Sui Capy in Sui Devnet network.
The contract source code can be found <a href="https://github.com/MystenLabs/sui/tree/main/sui_programmability/examples/capy">here</a>.</p>
<h2 id="creating-a-daemon"><a class="header" href="#creating-a-daemon">Creating a Daemon</a></h2>
<p>Let's say we want to emit an incident if a specific Capy is listed on the marketplace.
The function we need is called <code>list</code> and the code is
located <a href="https://github.com/MystenLabs/sui/blob/5478f7b4ba3de99c38bfcb4e6afa14496dba908e/sui_programmability/examples/capy/sources/capy_market.move#L126-L147">here</a>.</p>
<p>With Mamoru, there is two ways to track an item listing:</p>
<h4 id="direct-lookup-for-a-function-call"><a class="header" href="#direct-lookup-for-a-function-call">Direct lookup for a function call</a></h4>
<p>Mamoru traces every function call in the supported blockchains.
This way, we can write an SQL query that reacts to an arbitrary function call with arbitrary arguments.</p>
<p>Follow the blockchain schema for available fields.
// TODO: publish schemas for blockchains</p>
<p>Given that the published smart-contract module address is <code>0xA::capy_market</code> and the Capy id is <code>0xB</code>,
the query looks like this:</p>
<pre><code>SELECT * FROM transactions t
INNER JOIN call_traces ct ON t.seq = ct.tx_seq
INNER JOIN call_trace_args cta ON ct.seq = cta.call_trace_seq
WHERE 
	ct.transaction_module = &quot;0xA::capy_market&quot;
	AND ct.function = &quot;list&quot;
	AND as_string(cta.arg) = &quot;0xB&quot;
</code></pre>
<p>That query means: Mamoru will emit an incident if <code>0xA::capy_market::list</code> is called with <code>0xB</code> in arguments.</p>
<p>// TODO: add argument number to <code>call_trace_args</code> to query like <code>arg number N is X</code></p>
<h4 id="track-for-itemlisted-event"><a class="header" href="#track-for-itemlisted-event">Track for <code>ItemListed</code> event</a></h4>
<p>Mamoru traces all events that are emitted in the supported blockchains.
As per the contract code, <code>list</code> function emits <code>ItemListed</code> event which we can also track.</p>
<p>Given that the published smart-contract module address is <code>0xA::capy_market</code> and the Capy id is <code>0xB</code>,
the query looks like this:</p>
<pre><code>// TODO: support field parsing in custom Move events ¯\_(ツ)_/¯
</code></pre>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Testing are not implemented for daemons yet.
However, queries are validated during deploying phase.
You will receive an error message if your query has syntax issues, wrong tables/fields usage, types incompatibility etc.</p>
<h2 id="deploying"><a class="header" href="#deploying">Deploying</a></h2>
<p>To deploy the SQL daemon to Mamoru Validation Chain Testnet, you must submit a <code>register-daemon</code> transaction:</p>
<pre><code class="language-shell">validation-chaind tx \
  validationchain register-daemon $'{&quot;content&quot;: &quot;YOUR_SQL_QUERY&quot;, &quot;chain&quot;: {&quot;chain_type&quot;: 0}, &quot;activateSince&quot;: &quot;2022-12-13T15:35:58+00:00&quot;, &quot;inactivateSince&quot;: &quot;2032-12-13T15:35:58+00:00&quot;}' \
  --from sql-daemon-guide \
  --node https://validation-chain.testnet.mamoru.foundation:26657 \
  --chain-id validationchaintestnet
</code></pre>
<p>After a few minutes, Mamoru Sniffers will fetch your daemon and start querying new transaction against your query.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm-daemon-development"><a class="header" href="#wasm-daemon-development">WASM Daemon Development</a></h1>
<p>WASM Daemons allow you to define incident matching logic using any language that can be compiled to WebAssembly.
Currently, only <a href="https://www.assemblyscript.org/">AssemblyScript</a> is supported.
You can write a custom code against a blockchain context, decide when to emit an incident, customize message, severity, etc.</p>
<ol>
<li><a href="guides/wasm-daemon-development.html#prerequisite">Prerequisite</a>
<ol>
<li><a href="guides/wasm-daemon-development.html#setup-environment">Setup environment</a></li>
<li><a href="guides/wasm-daemon-development.html#define-contract-for-monitoring">Define contract for monitoring</a></li>
</ol>
</li>
<li><a href="guides/wasm-daemon-development.html#creating-a-daemon">Creating a Daemon</a></li>
<li><a href="guides/wasm-daemon-development.html#testing">Testing</a></li>
<li><a href="guides/wasm-daemon-development.html#deploying">Deploying</a></li>
</ol>
<h2 id="prerequisite-1"><a class="header" href="#prerequisite-1">Prerequisite</a></h2>
<h3 id="setup-environment-1"><a class="header" href="#setup-environment-1">Setup environment</a></h3>
<h4 id="install-validatoin-chaind-1"><a class="header" href="#install-validatoin-chaind-1">Install <code>validatoin-chaind</code></a></h4>
<p>You need the validation-chaind CLI to interact with the Mamoru Validation Chain.
It is available in the <code>mamorufoundation/validation-chain:latest</code> docker image.</p>
<p>Usage:</p>
<pre><code class="language-shell">docker run -it --rm mamorufoundation/validation-chain:latest {subcommand}
</code></pre>
<p>Consider creating a command alias for convenience:</p>
<pre><code class="language-shell">alias validation-chaind=&quot;docker run -it --rm -v $HOME/.validation-chain:/root/.validation-chain mamorufoundation/validation-chain:latest&quot;
</code></pre>
<h4 id="create-and-fund-an-account-1"><a class="header" href="#create-and-fund-an-account-1">Create and fund an account</a></h4>
<p>Execute the following command:</p>
<pre><code class="language-shell">validation-chaind keys add wasm-daemon-guide
</code></pre>
<p>This commands adds an account named <code>wasm-daemon-guide</code> to your keychain.
Take the newly created account address (look like <code>cosmos1qaar0r0tyyy6ufslam0hv9zvhvy0z0cv5x8xev</code>) and fund it with some tokens.</p>
<p>// TODO: make public faucet for a testnet</p>
<h3 id="define-contract-for-monitoring-1"><a class="header" href="#define-contract-for-monitoring-1">Define contract for monitoring</a></h3>
<p>In this guide, we will work with Gnosis Safe contract in Ethereum Goerli network.
The contract source code can be found <a href="https://github.com/safe-global/safe-contracts/tree/main/contracts">here</a>.</p>
<h2 id="creating-a-daemon-1"><a class="header" href="#creating-a-daemon-1">Creating a Daemon</a></h2>
<h3 id="init-assemblyscript-project"><a class="header" href="#init-assemblyscript-project">Init AssemblyScript project</a></h3>
<p>First, we need to init the project template.
Create a new directory, <code>cd</code> into it and run the following commands:</p>
<pre><code class="language-shell">npm init
npm install --save-dev assemblyscript@0.26.3
npx asinit .
</code></pre>
<h3 id="write-the-daemon-code"><a class="header" href="#write-the-daemon-code">Write the daemon code</a></h3>
<p>Let's emit an incident if someone withdraws money from the Safe.
The function we need is called <code>execTransaction</code>, the code is located <a href="https://github.com/safe-global/safe-contracts/blob/96a4e280876c33c53a09b5ef6ee78201a101ff58/contracts/Safe.sol#L119-L146">here</a>.</p>
<p>As we can see from the code, the function emits <code>ExecutionSuccess(bytes32,uint256)</code> event on success.
Keccak-256 hash of the event is <code>0x442e715f626346e8c54381002da614f62bee8d27386535b2521ec8540898556e</code>.
We will be tracking this event in the network transactions and emit an incident if it's found.</p>
<p>This how AssemblyScript Mamoru Daemon code may look like:</p>
<pre><code class="language-typescript">import { query, report } from &quot;@mamoru-ai/mamoru-sdk-as/assembly&quot;;

// `ExecutionSuccess(bytes32,uint256)` event
const SAFE_EXECUTION_SUCCESS_HASH: string = &quot;0x442e715f626346e8c54381002da614f62bee8d27386535b2521ec8540898556e&quot;;

// the address of your Gnosis Safe
const MY_SAFE_ADDRESS: string = &quot;0x785a205084ac256cad3133326abee31b5e53931a&quot;;

export function main(): void {
    let rows = query(`SELECT bytes_to_hex(e.topic0) AS topic0 FROM events e WHERE e.address = '${MY_SAFE_ADDRESS}'`);

    rows.forEach(row =&gt; {
        if (row.getString(&quot;topic0&quot;)!.valueOf() == SAFE_EXECUTION_SUCCESS_HASH) {
            report();
        }
    })
}
</code></pre>
<p>Replace <code>MY_SAFE_ADDRESS</code> to yours and put the resulting code into <code>./assembly/index.ts</code>.
Then, compile the code into WebAssembly binary:</p>
<pre><code class="language-shell">npx asc ./assembly/index.ts --target release --exportRuntime
</code></pre>
<p>You'll see a file <code>./build/release.wasm</code> that is the compiled daemon in WebAssembly format.</p>
<h2 id="testing-1"><a class="header" href="#testing-1">Testing</a></h2>
<p>Testing are not implemented for daemons yet.
However, WASM daemons are validated during deploying phase.
You will receive an error message if your WASM module is invalid, some types are incompatible etc.</p>
<h2 id="deploying-1"><a class="header" href="#deploying-1">Deploying</a></h2>
<p>To deploy the daemon to Mamoru Validation Chain Testnet, you must submit a <code>register-daemon</code> transaction:</p>
<pre><code class="language-shell">export DAEMON_BINARY=$(cat ./build/release.wasm | base64)

# TODO: the command is not valid yet, as per changes in `validation-chaind`
validation-chaind tx \
  validationchain register-daemon &quot;{\&quot;content\&quot;: \&quot;${DAEMON_BINARY}\&quot;, \&quot;chain\&quot;: {\&quot;chain_type\&quot;: 4}}&quot; \
  --from wasm-daemon-guide \
  --node https://validation-chain.testnet.mamoru.foundation:26657 \
  --chain-id validationchaintestnet
</code></pre>
<p>After a few minutes, Mamoru Sniffers will fetch your daemon and start running your daemon against blockchain transactions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mamoru-cli"><a class="header" href="#mamoru-cli">Mamoru CLI</a></h1>
<h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>Mamoru CLI is a system designed to rapidly develop Mamoru Daemon applications. It provides:</p>
<ul>
<li>Project scaffolding</li>
<li>A build system</li>
<li>A publishing system for validation chains</li>
</ul>
<p>Mamoru CLI aims to be the standard tool for creating daemons within the <a href="https://mamoru.ai">Mamoru project</a>. We work continuously to ensure that each piece works smoothly and is easy to use.</p>
<h2 id="components"><a class="header" href="#components">Components</a></h2>
<h3 id="cli"><a class="header" href="#cli">CLI</a></h3>
<p>The CLI is a globally installed <strong><a href="https://www.npmjs.com/">npm</a></strong> package that provides access to the <code>mamoru-cli</code> command in your terminal. It allows you to scaffold both SQL and <a href="https://webassembly.org/">WASM</a> Daemons via <code>mamoru-cli init</code>.</p>
<h3 id="validationchain"><a class="header" href="#validationchain">ValidationChain</a></h3>
<p>The validation chain is the core of Mamoru. It validates incoming incident reports, manages Daemons and DaemonMetadatas, and registers them in the blockchain.</p>
<h3 id="daemon"><a class="header" href="#daemon">Daemon</a></h3>
<p>A daemon is an entity deployed on a specified blockchain that detects and emits incidents to the validation chain.</p>
<h3 id="daemon-metadata"><a class="header" href="#daemon-metadata">Daemon Metadata</a></h3>
<p>Each daemon uses a &quot;master template&quot; that can be defined as a series of SQL queries or WASM code. This template is called &quot;Daemon Metadata&quot; and can be shared among many daemons if the developer allows it. Sharing a single metadata as the common source for several daemons allows each daemon to have a set of custom parameters defined during the creation of the metadata.</p>
<h3 id="the-centralized-platform"><a class="header" href="#the-centralized-platform">The centralized platform</a></h3>
<p>The centralized platform is responsible for listening to all events from the validation chain and sending notifications (SMS, email, webhook, Discord, etc.) to several subscribers. Users can manually or programmatically subscribe to daemon events and provide custom templates to format the data.</p>
<h1 id="initial-setup"><a class="header" href="#initial-setup">Initial Setup</a></h1>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<aside style="background-color: #e8feea; padding:10px">
✅  <b>Node version requirements</b>
<p>Mamoru-CLI requires <a href="https://nodejs.org/en/">Node.js</a> 16.x.x, you can manage multiple version of Node on the same machine using <a href="https://github.com/nvm-sh/nvm">nvm (MacOs, Linux)</a> or <a href="https://github.com/coreybutler/nvm-windows">nvm for windows</a></p>
</aside>
<p>To install the new package, use one of the following commands. You will need administrator privileges to execute these commands, unless npm was installed on your system through a Node.js version manager (such as n or nvm).</p>
<h3 id="using-npm"><a class="header" href="#using-npm">Using NPM</a></h3>
<pre><code class="language-jsx">npm install -g mamoru-cli
</code></pre>
<h3 id="using-yarn"><a class="header" href="#using-yarn">Using Yarn</a></h3>
<pre><code class="language-jsx">yarn global add mamoru-cli
</code></pre>
<h2 id="upgrading"><a class="header" href="#upgrading">Upgrading</a></h2>
<p>To upgrade the global Mamoru-CLI package, run:</p>
<h3 id="using-npm-1"><a class="header" href="#using-npm-1">Using NPM</a></h3>
<pre><code class="language-jsx">npm update -g mamoru-cli
</code></pre>
<h3 id="using-yarn-1"><a class="header" href="#using-yarn-1">Using Yarn</a></h3>
<pre><code class="language-jsx">yarn global upgrade --latest mamoru-cli
</code></pre>
<h1 id="creating-a-new-project"><a class="header" href="#creating-a-new-project">Creating a new project</a></h1>
<p>To create a new project, run:</p>
<pre><code class="language-jsx">mamoru-cli init my-new-daemon --type sql --chain sui
</code></pre>
<p>This command will create a SQL project targeting <em><a href="https://sui.io/">sui blockchain</a></em> in the &quot;my-new-daemon&quot; folder. To see all available parameters for the command, please check the reference</p>
<p>Once the project is created, you will see a prompt similar to this:</p>
<pre><code class="language-bash">Creating Queryable project files
Queryable project files created!

    ℹ️ To start working on your project, run:
        cd my-new-daemon
        npm install
    ℹ️ To start the project locally, run:
        npm run start
    ℹ️ To know more about how to create your own daemons, visit:
        https://docs.mamoru.io
</code></pre>
<p>To get started, move to your directory and install dependencies using either <code>npm install</code> or <code>yarn</code>.</p>
<p>You should see four files for SQL daemons:</p>
<ul>
<li><code>Readme.md</code>: This is a placeholder readme file for your project.</li>
<li><code>manifest.yml</code>: This file defines basic information about the daemon, such as its type, name, a custom logo URL, the target chain, and custom tags for discoverability.</li>
<li><code>package.json</code>: This is a minimal standard <code>package.json</code> file from NPM. It allows you to install custom AssemblyScript packages from the npm registry, and it's especially useful for WASM daemons. It also contains the build scripts used for WASM daemons.</li>
<li><code>queries.yml</code>: This file defines the queries that the daemon will run. At the time of deployment, these queries will be sent in the form of daemon metadata.</li>
</ul>
<h1 id="building-the-project"><a class="header" href="#building-the-project">Building the project.</a></h1>
<p>The building step is only required for WASM daemons. During this step, your <a href="https://www.assemblyscript.org/">AssemblyScript</a> source code will be transformed into a <code>.wasm</code> file that will later be sent to the validation chain as a daemon metadata. The dependencies required for compiling the source code are specified in the <code>package.json</code> file of each project, so each project can evolve at a different pace.</p>
<p>To run the build step use</p>
<pre><code class="language-bash">mamoru-cli build
</code></pre>
<p>Upon successful execution of the command, a <code>build</code> directory will appear in your project root.</p>
<h1 id="publishing-the-daemon"><a class="header" href="#publishing-the-daemon">Publishing the daemon.</a></h1>
<p>Once your project is completed, you can deploy your first daemon using the following command:</p>
<pre><code class="language-bash">mamoru-cli deploy --private-key &lt;YOUR_PRIVATE_KEY&gt;
</code></pre>
<p>The deploy command works in slightly different ways depending on the characteristics of your Daemon. Here, we provide a basic overview of these differences.</p>
<h2 id="for-sql-daemons"><a class="header" href="#for-sql-daemons">For SQL Daemons</a></h2>
<p>In this case, the deploy command verifies the <code>manifest.yml</code> and <code>queries.yml</code> files, transforms and signs the transaction using your private key, and sends it to the validation chain as a <em>Daemon Metadata</em>.</p>
<h2 id="for-wasm-daemons"><a class="header" href="#for-wasm-daemons">For WASM Daemons</a></h2>
<p>The <code>deploy</code> command verifies the existence of the <code>build</code> folder and performs a small validation of the sources. It then converts the binary to base64 format, creates and signs the transaction using the private key, and finally uses it to create a <em>Daemon Metadata</em>.</p>
<p>Keep in mind that the base64 string of the binary may require extra gas to be processed. Depending on your case, you may need to add some extra gas. To do this, use the <code>--gas</code> flag.</p>
<pre><code class="language-bash">mamoru-cli deploy --private-key &lt;YOUR_PRIVATE_KEY&gt; --gas 1000000
</code></pre>
<h2 id="for-sole-or-subscribable-daemons"><a class="header" href="#for-sole-or-subscribable-daemons">For SOLE or SUBSCRIBABLE Daemons</a></h2>
<p>At this point, you may have noticed a <code>subscribable</code> field in your <strong>manifest.yml</strong> file. Daemons can have two types: <strong>SOLE</strong> or <strong>SUBSCRIBABLE</strong>.</p>
<p>Creating a <strong>SOLE</strong> daemon means that only you can spawn new instances of the daemon metadata. In this case, running the <code>deploy</code> command will first create the <em>Daemon Metadata</em>, and then the <em>Daemon</em> itself in a subsequent call.</p>
<p>Creating a <strong>SUBSCRIBABLE</strong> daemon means that the <code>deploy</code> command will only create a <em>Daemon Metadata</em>, and the <em>Daemon</em> instance can be spawned later by you or any other person interacting with the validation chain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mamoru-cli-reference"><a class="header" href="#mamoru-cli-reference">Mamoru CLI Reference</a></h1>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h2>
<pre><code>mamoru-cli [options] [command]

Options:
  -v, --verbose             define verbosity to show execution logs
  -h, --help                display help for command
</code></pre>
<h2 id="commands"><a class="header" href="#commands">Commands</a></h2>
<h3 id="init"><a class="header" href="#init">init</a></h3>
<pre><code>Usage:  init [options] &lt;path&gt;

Arguments:
  path                             path to folder with queryable project (default: &quot;&quot;)

Options:
  -t, --type &lt;type&gt;                Type of project (choices: &quot;sql&quot;, &quot;wasm&quot;, default: &quot;wasm&quot;)
  -c, --chain &lt;chain&gt;              Chain where the daemon runs (choices: &quot;ethereum&quot;, &quot;bsc&quot;, &quot;sui&quot;)
  -n, --name &lt;name&gt;                Name of the project (default: &quot;Default Name&quot;)
  -d, --description &lt;description&gt;  Description of the project (default: &quot;Mamoru Daemon&quot;)
  -t, --tags &lt;tags&gt;                Tags of the project, comma separated (default: &quot;mamoru,daemon&quot;)
  -l, --logo &lt;logo&gt;                Logo of the project, should be an url (default:
                                   &quot;https://mamoru.ai/default-daemon-logo.png&quot;)
  --subscribable                   If the project is subscribable, or standalone (default: false)
  -h, --help                       display help for command

</code></pre>
<h3 id="build"><a class="header" href="#build">build</a></h3>
<pre><code>Usage:  build [options] [path]

compile project

Arguments:
  path        path to folder with queryable project (default: &quot;.&quot;)

Options:
  -h, --help  display help for command

</code></pre>
<h3 id="publish"><a class="header" href="#publish">publish</a></h3>
<pre><code>Usage:  publish [options] [path]

publish project

Arguments:
  path                     path to folder with queryable project (default: &quot;.&quot;)

Options:
  --rpc &lt;rpcUrl&gt;           rpc url of the chain
  --gas &lt;gas&gt;              gas fee of the transaction (default: &quot;200000&quot;)
  -k, --private-key &lt;key&gt;  Private key of the account that will be used to publish the project
  -h, --help               display help for command

</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
